%clear all;
%%
% % a=[43,51,30,39,61,92,45;...
% %    63,64,51,54,63,73,47;...
% %    71,70,68,69,76,86,48;...
% %    61,63,45,47,54,84,35;...
% %    81,78,56,66,71,83,47;...
% %    43,55,49,44,54,49,34;...
% %    58,67,42,56,66,68,35;...
% %    71,75,50,55,70,66,41;...
% %    72,82,72,67,71,83,31;...
% %    67,61,45,47,62,80,41;...
% %    64,53,53,58,58,67,34;...
% %    67,60,47,39,59,74,41;...
% %    69,62,57,42,55,63,25;...
% %    68,83,83,45,59,77,35;...
% %    77,77,54,72,79,77,46;...
% %    81,90,50,72,60,54,36;...
% %    74,85,64,69,79,79,63;...
% %    65,60,65,75,55,80,60;...
% %    65,70,46,57,75,85,46;...
% %    50,58,68,54,64,78,52;...
% %    50,40,33,34,43,64,33;...
% %    64,61,52,62,66,80,41;...
% %    53,66,52,50,63,80,37;...
% %    40,37,42,58,50,57,49;...
% %    63,54,42,48,66,75,33;...
% %    66,77,66,63,88,76,72;...
% %    78,75,58,74,80,78,49;...
% %    48,57,44,45,51,83,38;...
% %    85,85,71,71,77,74,55;...
% %    82,82,39,59,64,78,39];
% % stepwise([ones(size(a(:,1))),a(:,2:7)],a(:,1))
%% 
% x = [2100 2300 2500 2700 2900 3100 ...
%      3300 3500 3700 3900 4100 4300]';
% n = [48 42 31 34 31 21 23 23 21 16 17 21]';
% y = [1 2 0 3 8 8 14 17 19 15 17 21]';
% b = glmfit(x,[y n],'binomial','link','probit');
% yfit = glmval(b, x,'probit','size', n);
% plot(x, y./n,'o',x,yfit./n,'-','LineWidth',2)
%%
% data=[0,-62.8,-89.5,1.7;...
%     0,3.3,-3.5,1.1;...
%     0,-120.8,-103.2,2.5;...
%     0,-18.1,-28.8,1.1;...
%     0,-3.8,-50.6,0.9;...
%     0,-61.2,-56.2,1.7;...
%     0,-20.3,-17.4,1.0;...
%     0,-194.5,-25.8,0.5;...
%     0,20.8,-4.3,1.0;...
%     0,-106.1,-22.9,1.5;...
%     0,-39.4,-35.7,1.2;...
%     0,-164.1,-17.7,1.3;...
%     0,-308.9,-65.8,0.8;...
%     0,7.2,-22.6,2.0;...
%     0,-118.3,-34.2,1.5;...
%     0,-185.9,-280.0,6.7;...
%     0,-34.6,-19.4,3.4;...
%     0,-27.9,6.3,1.3;...
%     0,-48.2,6.8,1.6;...
%     0,-49.2,-17.2,0.3;...
%     0,-19.2,-36.7,0.8;...
%     0,-18.1,-6.5,0.9;...
%     0,-98.0,-20.8,1.7;...
%     0,-129.0,-14.2,1.3;...
%     0,-4.0,-15.8,2.1;...
%     0,-8.7,-36.3,2.8;...
%     0,-59.2,-12.8,2.1;...
%     0,-13.1,-17.6,0.9;...
%     0,-38.0,1.6,1.2;...
%     0,-57.9,0.7,0.8;...
%     0,-8.8,-9.1,0.9;...
%     0,-64.7,-4.0,0.1;...
%     0,-11.4,4.8,0.9;...
%     1,43.0,16.4,1.3;...
%     1,47.0,16.0,1.9;...
%     1,-3.3,4.0,2.7;...
%     1,35.0,20.8,1.9;...
%     1,46.7,12.6,0.9;...
%     1,20.8,12.5,2.4;...
%     1,33.0,23.6,1.5;...
%     1,26.1,10.4,2.1;...
%     1,68.6,13.8,1.6;...
%     1,37.3,33.4,3.5;...
%     1,59.0,23.1,5.5;...
%     1,49.6,23.8,1.9;...
%     1,12.5,7.0,1.8;...
%     1,37.3,34.1,1.5;...
%     1,35.3,4.2,0.9;...
%     1,49.5,25.1,2.6;...
%     1,18.1,13.5,4.0;...
%     1,31.4,15.7,1.9;...
%     1,21.5,-14.4,1.0;...
%     1,8.5,5.8,1.5;...
%     1,40.6,5.8,1.8;...
%     1,34.6,26.4,1.8;...
%     1,19.9,26.7,2.3;...
%     1,17.4,12.6,1.3;...
%     1,54.7,14.6,1.7;...
%     1,53.5,20.6,1.1;...
%     1,35.9,26.4,2.0;...
%     1,39.4,30.5,1.9;...
%     1,53.1,7.1,1.9;...
%     1,39.8,13.8,1.2;...
%     1,59.5,7.0,2.0;...
%     1,16.3,20.4,1.0;...
%     1,21.7,-7.8,1.6;];
% x=data(:,2:end);
% prime_y=data(:,1);
% sp = nominal(prime_y);
% y = double(sp);
% [b,dev,stats] = mnrfit(x,y);
% yfit=mnrval(b, x,stats);
% l=yfit(:,2)+prime_y;
% ty=(yfit(:,2)>0.5);
% log_ty=prime_y-ty;
% prob_y=1-sum(abs(log_ty))/length(log_ty);%拟合正确率
%%
% p=[68;55;66;32;21;25];
% o=[42;38;20;10;7;4];
% n=p+o;
% x=[25;26;27;28;29;30];
% y=[p,n];
% [b,dev,stats] = glmfit(x,y,'binomial','link','logit');
%%
% p=[1;2;6;13;3;7;13;20;7;14;20;25;15;20;23;31;3;5;7;12;5;10;10;14;9;13;15;15;14;16;16;11];
% o=[49;97;142;185;96;140;182;176;141;183;170;137;179;157;117;101;198;207;189;189;179;236;163;137;193;184;147;91;186;151;83;41];
% n=p+o;
% data=[1,1,1;1,1,2;1,1,3;1,1,4;...
%     1,2,1;1,2,3;1,2,3;1,2,4;...
%     1,3,1;1,3,2;1,3,3;1,3,4;...
%     1,4,1;1,4,2;1,4,3;1,4,4;...
%     0,1,1;0,1,2;0,1,3;0,1,4;...
%     0,2,1;0,2,2;0,2,3;0,2,4;...
%     0,3,1;0,3,2;0,3,3;0,3,4;...
%     0,4,1;0,4,2;0,4,3;0,4,4];
% x=data;
% y=[p,n];
% [b,dev,stats] = glmfit(x,y,'binomial','link','logit');
%%
data=[2.5,0,0,0;...
    173,2,0,0;...
    119,2,0,0;...
    10,2,0,0;...
    502.2,2,0,0;...
    4,0,0,0;...
    14.4,0,1,0;...
    2,2,0,0;...
    40,2,0,0;...
    6.6,0,0,0;...
    21.4,2,1,0;...
    2.8,0,0,0;...
    2.5,0,0,0;...
    6,0,0,0;...
    3.5,0,1,0;...
    62.2,0,0,1;...
    10.8,0,1,1;...
    21.6,0,1,1;...
    2,0,1,1;...
    3.4,1,1,1;...
    5.1,0,1,1;...
    2.4,0,0,1;...
    1.7,0,1,1;...
    1.1,0,1,1;...
    12.8,0,1,1;...
    1.2,2,0,0;...
    3.5,0,0,0;...
    39.7,0,0,0;...
    62.4,0,0,0;...
    2.4,0,0,0;...
    34.7,0,0,0;...
    28.4,2,0,0;...
    0.9,0,1,0;...
    30.6,2,0,0;...
    5.8,0,1,0;...
    6.1,0,1,0;...
    2.7,2,1,0;...
    4.7,0,0,0;...
    128,2,1,0;...
    35.0,0,0,0;...
    2,0,0,1;...
    8.5,0,1,1;...
    2,2,1,1;...
    2,0,1,1;...
    4.3,0,1,1;...
    244.8,2,1,1;...
    4,0,1,1;...
    5.1,0,1,1;...
    32,0,1,1;...
    1.4,0,1,1];
x=data(:,1:end-1);
prime_y=data(:,end);
sp = nominal(prime_y);
y = double(sp);
[b1,dev,stats] = mnrfit(x,y);
yfit=mnrval(b, x,stats);
eval_y=(yfit(:,2)>0.5);
eval_y11=sum(eval_y(prime_y>0,:)==1);
eval_y22=sum(eval_y(~prime_y>0,:)==0);
eval_y12=sum(eval_y(prime_y>0,:)==0);
eval_y21=sum(eval_y(~prime_y>0,:)==1);
prob_y=[eval_y11./(eval_y11+eval_y12),eval_y12./(eval_y11+eval_y12);eval_y21./(eval_y21+eval_y22),eval_y22./(eval_y21+eval_y22)];%拟合正确率
prob_YValue=(eval_y11+eval_y22)./(eval_y11+eval_y12+eval_y21+eval_y22);
% l=yfit(:,2)+prime_y;
% log_ty=prime_y-eval_y;
% 